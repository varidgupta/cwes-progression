<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Officer Promotion Simulator</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
        .container { max-width: 900px; margin: 20px auto; background: white; padding: 20px; border-radius: 8px; }
        h1, h2 { text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background: #eee; }
        input[type="number"], input[type="date"], select { width: 100%; padding: 5px; }
        button { padding: 10px 20px; background: #007BFF; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
<div class="container">
    <h1>Officer Promotion Simulator</h1>

    <!-- Officer List -->
    <h2>Officer List</h2>
    <div style="max-height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px;">
        <table id="officerListTable" border="1" cellpadding="5" cellspacing="0" style="width:100%; border-collapse: collapse;"></table>
    </div>

    <!-- Sanctioned Strength Table -->
    <h2>Sanctioned Strength</h2>
    <table id="sanctionedStrengthTable">
        <tr>
            <th>Rank</th>
            <th>Strength</th>
            <th>Deputation Strength</th>
        </tr>
        <tr><td>Apex</td><td><input type="number" value="1"></td><td><input type="number" value="0"></td></tr>
        <tr><td>HAG</td><td><input type="number" value="6"></td><td><input type="number" value="1"></td></tr>
        <tr><td>SAG</td><td><input type="number" value="46"></td><td><input type="number" value="10"></td></tr>
        <tr><td>JAG</td><td><input type="number" value="164"></td><td><input type="number" value="15"></td></tr>
        <tr><td>STS</td><td><input type="number" value="249"></td><td><input type="number" value="10"></td></tr>
        <tr><td>JTS</td><td><input type="number" value="262"></td><td><input type="number" value="2"></td></tr>
    </table>

    <!-- Promotion Criteria Table -->
    <h2>Promotion Criteria (Years)</h2>
    <table id="promotionCriteriaTable">
        <tr>
            <th>Rank</th>
            <th>Criteria</th>
            <th>Value</th>
            <th>Regular Service From</th>
        </tr>
        <tr><td>Apex</td><td>Min Years at HAG</td><td><input type="number" step="0.1" value="2"></td><td><select><option>regular service from 1st Jan of following year</option><option>regular service from 1st Jan of same year</option><option>regular service from date of assuming the post</option></select></td></tr>
        <tr><td>HAG</td><td>Min Years from JTS</td><td><input type="number" value="25"></td><td><select><option>regular service from 1st Jan of following year</option><option>regular service from 1st Jan of same year</option><option>regular service from date of assuming the post</option></select></td></tr>
        <tr><td>HAG</td><td>Min Years at SAG</td><td><input type="number" value="1"></td><td><select><option>regular service from 1st Jan of following year</option><option>regular service from 1st Jan of same year</option><option>regular service from date of assuming the post</option></select></td></tr>
        <tr><td>HAG</td><td>Or Min Years at SAG</td><td><input type="number" value="3"></td><td><select><option>regular service from 1st Jan of following year</option><option>regular service from 1st Jan of same year</option><option>regular service from date of assuming the post</option></select></td></tr>
        <tr><td>SAG</td><td>Min Years from JTS</td><td><input type="number" value="17"></td><td><select><option>regular service from 1st Jan of following year</option><option>regular service from 1st Jan of same year</option><option>regular service from date of assuming the post</option></select></td></tr>
        <tr><td>SAG</td><td>Min Years at JAG</td><td><input type="number" value="1"></td><td><select><option>regular service from 1st Jan of following year</option><option>regular service from 1st Jan of same year</option><option>regular service from date of assuming the post</option></select></td></tr>
        <tr><td>SAG</td><td>Or Min Years at JAG</td><td><input type="number" value="3"></td><td><select><option>regular service from 1st Jan of following year</option><option>regular service from 1st Jan of same year</option><option>regular service from date of assuming the post</option></select></td></tr>
        <tr><td>JAG</td><td>Min Years from JTS</td><td><input type="number" value="13"></td><td><select><option>regular service from 1st Jan of following year</option><option>regular service from 1st Jan of same year</option><option>regular service from date of assuming the post</option></select></td></tr>
        <tr><td>JAG</td><td>Min Years at STS</td><td><input type="number" value="4"></td><td><select><option>regular service from 1st Jan of following year</option><option>regular service from 1st Jan of same year</option><option>regular service from date of assuming the post</option></select></td></tr>
        <tr><td>JAG</td><td>Or Min Years at STS</td><td><input type="number" value="9"></td><td><select><option>regular service from 1st Jan of following year</option><option>regular service from 1st Jan of same year</option><option>regular service from date of assuming the post</option></select></td></tr>
        <tr><td>STS</td><td>Min Years at JTS</td><td><input type="number" value="4"></td><td><select><option>regular service from 1st Jan of following year</option><option>regular service from 1st Jan of same year</option><option>regular service from date of assuming the post</option></select></td></tr>
    </table>

    <!-- Simulation Start Date -->
    <h2>Simulation Start Date</h2>
    <input type="date" id="startDate" value="2024-12-01">

    <!-- Execute Button -->
    <div style="margin-top: 20px; text-align: center;">
        <button onclick="executeSimulation()">Execute Simulation</button>
    </div>

    <!-- Results -->
    <h2>Results</h2>
    <div id="result"></div>
</div>

<script>
function excelSerialToDate(serial) {
    if (typeof serial !== 'number') return serial;
    let utc_days = Math.floor(serial - 25569);
    let utc_value = utc_days * 86400; 
    let date_info = new Date(utc_value * 1000);
    return date_info.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
}

function loadOfficerList() {
    fetch('officers_list_1.json') // Assume JSON generated from Excel on server
        .then(response => response.json())
        .then(data => {
            const table = document.getElementById('officerListTable');
            table.innerHTML = '';
            data.forEach((row, i) => {
                let tr = document.createElement('tr');
                row.forEach(cell => {
                    let td = document.createElement(i === 0 ? 'th' : 'td');
                    if (!isNaN(cell) && cell > 20000 && cell < 50000) {
                        td.textContent = excelSerialToDate(cell);
                    } else {
                        td.textContent = cell;
                    }
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            });
        });
}

function executeSimulation() {
    const sanctionedStrength = {};
    document.querySelectorAll('#sanctionedStrengthTable tr').forEach((row, i) => {
        if (i === 0) return;
        const rank = row.cells[0].innerText;
        const value = parseInt(row.cells[1].querySelector('input').value);
        const deputation = parseInt(row.cells[2].querySelector('input').value);
        sanctionedStrength[rank] = { strength: value, deputation: deputation };
    });

    const promotionCriteria = {};
    document.querySelectorAll('#promotionCriteriaTable tr').forEach((row, i) => {
        if (i === 0) return;
        const rank = row.cells[0].innerText;
        const criteriaName = row.cells[1].innerText;
        const value = parseFloat(row.cells[2].querySelector('input').value);
        const serviceFrom = row.cells[3].querySelector('select').value;
        if (!promotionCriteria[rank]) promotionCriteria[rank] = [];
        promotionCriteria[rank].push({ criteria: criteriaName, value: value, serviceFrom: serviceFrom });
    });

    const startDate = document.getElementById('startDate').value;

    document.getElementById('result').innerHTML =
        `<pre>Sanctioned Strength: ${JSON.stringify(sanctionedStrength, null, 2)}\n\nPromotion Criteria: ${JSON.stringify(promotionCriteria, null, 2)}\n\nStart Date: ${startDate}</pre>`;
}

window.onload = loadOfficerList;
</script>
</body>
</html>
